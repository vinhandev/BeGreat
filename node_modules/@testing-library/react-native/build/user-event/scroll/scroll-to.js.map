{"version":3,"file":"scroll-to.js","names":["_jestMatcherUtils","require","_eventBuilder","_errors","_hostComponentNames","_object","_utils","_utils2","_state","scrollTo","element","options","isHostScrollView","ErrorWithStack","type","ensureScrollViewDirection","initialPosition","getElementScrollOffset","dragSteps","createScrollSteps","y","x","linearInterpolator","emitDragScrollEvents","config","momentumStart","at","momentumSteps","momentumY","momentumX","inertialInterpolator","emitMomentumScrollEvents","finalPosition","setElementScrollOffset","scrollSteps","length","wait","dispatchEvent","EventBuilder","ScrollView","scroll","i","lastStep","isVerticalScrollView","props","horizontal","hasHorizontalScrollOptions","undefined","stringify","pick","hasVerticalScrollOptions"],"sources":["../../../src/user-event/scroll/scroll-to.ts"],"sourcesContent":["import { ReactTestInstance } from 'react-test-renderer';\nimport { stringify } from 'jest-matcher-utils';\nimport { UserEventConfig, UserEventInstance } from '../setup';\nimport { EventBuilder } from '../event-builder';\nimport { ErrorWithStack } from '../../helpers/errors';\nimport { isHostScrollView } from '../../helpers/host-component-names';\nimport { pick } from '../../helpers/object';\nimport { dispatchEvent, wait } from '../utils';\nimport { ContentOffset } from '../event-builder/scroll-view';\nimport {\n  createScrollSteps,\n  inertialInterpolator,\n  linearInterpolator,\n} from './utils';\nimport { getElementScrollOffset, setElementScrollOffset } from './state';\n\nexport interface VerticalScrollToOptions {\n  y: number;\n  momentumY?: number;\n\n  // Vertical scroll should not contain horizontal scroll part.\n  x?: never;\n  momentumX?: never;\n}\n\nexport interface HorizontalScrollToOptions {\n  x: number;\n  momentumX?: number;\n\n  // Horizontal scroll should not contain vertical scroll part.\n  y?: never;\n  momentumY?: never;\n}\n\nexport type ScrollToOptions =\n  | VerticalScrollToOptions\n  | HorizontalScrollToOptions;\n\nexport async function scrollTo(\n  this: UserEventInstance,\n  element: ReactTestInstance,\n  options: ScrollToOptions\n): Promise<void> {\n  if (!isHostScrollView(element)) {\n    throw new ErrorWithStack(\n      `scrollTo() works only with host \"ScrollView\" elements. Passed element has type \"${element.type}\".`,\n      scrollTo\n    );\n  }\n\n  ensureScrollViewDirection(element, options);\n\n  const initialPosition = getElementScrollOffset(element);\n  const dragSteps = createScrollSteps(\n    { y: options.y, x: options.x },\n    initialPosition,\n    linearInterpolator\n  );\n  await emitDragScrollEvents(this.config, element, dragSteps);\n\n  const momentumStart = dragSteps.at(-1) ?? initialPosition;\n  const momentumSteps = createScrollSteps(\n    { y: options.momentumY, x: options.momentumX },\n    momentumStart,\n    inertialInterpolator\n  );\n  await emitMomentumScrollEvents(this.config, element, momentumSteps);\n\n  const finalPosition =\n    momentumSteps.at(-1) ?? dragSteps.at(-1) ?? initialPosition;\n  setElementScrollOffset(element, finalPosition);\n}\n\nasync function emitDragScrollEvents(\n  config: UserEventConfig,\n  element: ReactTestInstance,\n  scrollSteps: ContentOffset[]\n) {\n  if (scrollSteps.length === 0) {\n    return;\n  }\n\n  await wait(config);\n  dispatchEvent(\n    element,\n    'scrollBeginDrag',\n    EventBuilder.ScrollView.scroll(scrollSteps[0])\n  );\n\n  // Note: experimentally, in case of drag scroll the last scroll step\n  // will not trigger `scroll` event.\n  // See: https://github.com/callstack/react-native-testing-library/wiki/ScrollView-Events\n  for (let i = 1; i < scrollSteps.length - 1; i += 1) {\n    await wait(config);\n    dispatchEvent(\n      element,\n      'scroll',\n      EventBuilder.ScrollView.scroll(scrollSteps[i])\n    );\n  }\n\n  await wait(config);\n  const lastStep = scrollSteps.at(-1);\n  dispatchEvent(\n    element,\n    'scrollEndDrag',\n    EventBuilder.ScrollView.scroll(lastStep)\n  );\n}\n\nasync function emitMomentumScrollEvents(\n  config: UserEventConfig,\n  element: ReactTestInstance,\n  scrollSteps: ContentOffset[]\n) {\n  if (scrollSteps.length === 0) {\n    return;\n  }\n\n  await wait(config);\n  dispatchEvent(\n    element,\n    'momentumScrollBegin',\n    EventBuilder.ScrollView.scroll(scrollSteps[0])\n  );\n\n  // Note: experimentally, in case of momentum scroll the last scroll step\n  // will trigger `scroll` event.\n  // See: https://github.com/callstack/react-native-testing-library/wiki/ScrollView-Events\n  for (let i = 1; i < scrollSteps.length; i += 1) {\n    await wait(config);\n    dispatchEvent(\n      element,\n      'scroll',\n      EventBuilder.ScrollView.scroll(scrollSteps[i])\n    );\n  }\n\n  await wait(config);\n  const lastStep = scrollSteps.at(-1);\n  dispatchEvent(\n    element,\n    'momentumScrollEnd',\n    EventBuilder.ScrollView.scroll(lastStep)\n  );\n}\n\nfunction ensureScrollViewDirection(\n  element: ReactTestInstance,\n  options: ScrollToOptions\n) {\n  const isVerticalScrollView = element.props.horizontal !== true;\n\n  const hasHorizontalScrollOptions =\n    options.x !== undefined || options.momentumX !== undefined;\n  if (isVerticalScrollView && hasHorizontalScrollOptions) {\n    throw new ErrorWithStack(\n      `scrollTo() expected only vertical scroll options: \"y\" and \"momentumY\" for vertical \"ScrollView\" element but received ${stringify(\n        pick(options, ['x', 'momentumX'])\n      )}`,\n      scrollTo\n    );\n  }\n\n  const hasVerticalScrollOptions =\n    options.y !== undefined || options.momentumY !== undefined;\n  if (!isVerticalScrollView && hasVerticalScrollOptions) {\n    throw new ErrorWithStack(\n      `scrollTo() expected only horizontal scroll options: \"x\" and \"momentumX\" for horizontal \"ScrollView\" element but received ${stringify(\n        pick(options, ['y', 'momentumY'])\n      )}`,\n      scrollTo\n    );\n  }\n}\n"],"mappings":"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"}